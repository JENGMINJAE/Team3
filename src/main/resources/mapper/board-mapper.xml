<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="board">
    <resultMap id="boardMap" type="com.green.Team3.board.vo.BoardVO">
        <id column="BOARD_NUM"                   property="boardNum"/>
        <result column="BOARD_TITLE"             property="boardTitle"/>
        <result column="BOARD_CONTENT"           property="boardContent"/>
        <result column="MEMBER_ID"               property="memberId"/>
        <result column="TYPE_NUM"                property="typeNum"/>
        <result column="BOARD_CNT"               property="boardCnt"/>
    </resultMap>

    <resultMap id="boardTypeMap" type="com.green.Team3.board.vo.BoardTypeVO">
        <id column="TYPE_NUM"                    property="typeNum"/>
        <result column="TYPE_NAME"               property="typeName"/>
    </resultMap>

    <!-- 다음에 INSERT 할 공지사항 BOARD_NUM 조회 -->
    <select id="selectNextNoticeCode" resultType="int">
        SELECT IFNULL(MAX(BOARD_NUM), 0) + 1
        FROM BOARD
    </select>

    <!-- 공지사항 목록 조회 -->
    <!-- 이너조인 memberRoll 가져오기-->
    <select id="selectNoticeList" resultMap="boardMap">
        SELECT BOARD_NUM
            , BOARD_TITLE
            , BOARD_CONTENT
            , B.MEMBER_ID
            , TYPE_NUM
            , BOARD_CNT
            , MEMBER_ROLL
        FROM BOARD B
        INNER JOIN MEMBER M
        ON B.MEMBER_ID = M.MEMBER_ID
        <if test='searchValue != null and !searchValue.equals("")'>
            WHERE ${searchType} LIKE CONCAT('%', #{searchValue}, '%')
        </if>
        ORDER BY BOARD_NUM DESC
        LIMIT ${displayDataCnt} OFFSET ${displayDataCnt * (nowPage - 1)}
    </select>

    <!-- 공지사항 게시글 작성 -->
    <insert id="insertNotice">
        INSERT INTO BOARD (
            BOARD_TITLE
            , BOARD_CONTENT
            , MEMBER_ID
            , TYPE_NUM
        ) VALUES (
            #{boardTitle}
            , #{boardContent}
            , #{memberId}
            , #{typeNum}
        )
    </insert>

    <!-- 공지사항 상세 조회 -->
    <select id="selectNoticeDetail" resultMap="boardMap">
        SELECT BOARD_NUM
            , BOARD_TITLE
            , BOARD_CONTENT
            , MEMBER_ID
            , TYPE_NUM
            , BOARD_CNT
        FROM BOARD
        WHERE BOARD_NUM = #{boardNum}
    </select>

    <!-- 공지사항 조회수 증가 -->
    <update id="updateBoardCnt">
        UPDATE BOARD
        SET
            BOARD_CNT = BOARD_CNT + 1
        WHERE BOARD_NUM = #{boardNum}
    </update>

    <!-- 공지사항 게시글 삭제 -->
    <delete id="deleteNotice">
        DELETE FROM BOARD
        WHERE BOARD_NUM = #{boardNum}
    </delete>

    <!-- 공지사항 게시글 수 조회 -->
    <select id="selectNoticeCnt" resultType="int">
        SELECT COUNT(BOARD_NUM)
        FROM BOARD
    </select>








</mapper>































